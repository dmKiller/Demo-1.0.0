/*! songt 2015-01-29 */
function CmccTime(t){this.timeArr=t}function initBasicData(){var t=arguments[0],e=arguments[1],a=arguments[2];$("#timeDay").html(t),$("#timeArr").val(e),$("#timeModalArr").val(e),$("#serviceDataJson").val(JSON.stringify(a)),initDateChoose();var r=new CmccTime(timeStrToArrBySort($("#timeArr").val()));r.render(),initDetailModal()}function initDetailModal(){$("#startTime").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii",autoclose:1}),$("#endTime").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii",autoclose:1}),$(document).on("click",".item-count",function(){$("#detailModal").modal("show")})}function showServiceData(t){var e=JSON.parse($("#serviceDataJson").val());if(t==e.length&&(t=0),null!==e[t]||e[t]!==void 0){var a,r=e[t];for(var i in r.data)a="",a=60>r.data[i]?"font-red":80>=r.data[i]&&r.data[i]>=60?"font-orange":"font-green",$("[service-name = "+i+"]").removeClass(),$("[service-name = "+i+"]").addClass(a),$("[service-name = "+i+"]").html(r.data[i]+"<em> %</em>")}else console.log("error");$("#header-time-select").val(t)}function getIndexStr(t){var e=JSON.parse($("#serviceDataJson").val());return t==e.length&&(t=0),e[t].time}function changeTime(){var t=JSON.parse($("#serviceDataJson").val());if(3>=t.length)$(".cal-time-item").slickGoTo($("#header-time-select").val());else{var e=0;e=0>parseInt($("#header-time-select").val())-1?t.length-1:parseInt($("#header-time-select").val())-1,$(".cal-time-item").slickGoTo(e)}showServiceData($("#header-time-select").val())}function openTimeModal(){$("#hourPoint").val("00"),$("#minPoint").val("00"),$("#dayPoint").val($("#timeDay").html()),$("#timeModalArr").val($("#timeArr").val()),refreshTimePoint(),$("#cmccModal").modal("show")}function closeTimeModal(){$("#timeModalArr").val($("#timeArr").val())}function initDateChoose(){for(var t=JSON.parse($("#serviceDataJson").val()),e="",a=0;t.length>a;a++)e+="<option value="+t[a].idx+">"+t[a].time+"</option>";$("#header-time-select").html(e),$("#dayPoint").val((new Date).Format("YYYY-MM-DD")),$("#dayPoint").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd",todayBtn:!0,endDate:new Date,minView:2,autoclose:1});for(var r="",a=0;24>a;a++)a=10>a?"0"+a:a,r+="<option value='"+a+"'>"+a+"</option>";$("#hourPoint").html(r);for(var i="",a=0;59>a;a++)0==a%5&&(a=10>a?"0"+a:a,i+="<option value='"+a+"'>"+a+"</option>");$("#minPoint").html(i),$(document).on("click",".btn-delete-time",function(){for(var t=$(this).siblings("span").html().split("-"),e=$("#timeModalArr").val().split(","),a=0;e.length>a;a++)"00:00"!=e[a]&&"23:59"!=e[a]&&(e[a]==t[0]&&e[a]||e[a]==t[1]&&e[a])&&e.del(a);$("#timeModalArr").val(arrToStr(e)),refreshTimePoint()})}function addTimePoint(){function t(t,e){for(var a=e.split(","),r=0;a.length>r;r++)if(t==a[r])return!0;return!1}var e=$("#hourPoint").val(),a=$("#minPoint").val(),r=e+":"+a;t(r,$("#timeModalArr").val())?alert("请不要重复添加时间切割点"):($("#timeModalArr").val($("#timeModalArr").val()+","+r),refreshTimePoint())}function refreshTimePoint(){var t=timeStrToArrBySort($("#timeModalArr").val());$(".st-list-content").empty();for(var e=0;t.length>e;e++)$(".st-list-content").append("<li><span>"+t[e]+"</span>"+"<button type='button' class='btn btn-link btn-xs btn-delete-time'>&times;</button></li>")}function saveTimeConfig(){$("#timeArr").val($("#timeModalArr").val()),$("#timeDay").html((new Date).getStDate($("#dayPoint").val()).Format("YYYY-MM-dd"));var t=new CmccTime(timeStrToArrBySort($("#timeArr").val()));t.render(),$("#cmccModal").modal("hide")}function arrToStr(t){for(var e="",a=0;t.length>a;a++)e+=t[a]+",";return e.substring(0,e.length-1).split(",")}function timeStrToArrBySort(){if(1==arguments.length){var t=arguments[0].split(",");return t.sort(),timeStrToArr(t)}if(2==arguments.length){var t=arguments[0].split(",");for(var e in t)if(arguments[1]!==t[e])return alert("请不要重复添加时间切割点."),t.sort(),strToArr(t);return t.push(arguments[1]),t.sort(),timeStrToArr(t)}return t}function timeStrToArr(t){for(var e="",a=0;t.length>a;a++)(null!=t[a+1]||t[a+1]!==void 0)&&(e+=""+t[a]+"-"+t[a+1]+",");var t=e.substring(0,e.length-1).split(",");return t}CmccTime.prototype.render=function(){this._initData()},CmccTime.prototype._initData=function(){function t(t){function e(t){switch(a(),"prev"==t?r.slickPrev():r.slickNext(),l){case 1:return r.slickCurrentSlide();case 3:return r.slickCurrentSlide()+1}}function a(){$(".cal-select-flag").addClass("cal-select-turn"),setTimeout(function(){$(".cal-select-flag").removeClass("cal-select-turn")},300)}this.timeClassName=t.timeClassName,this.arrowLeftClassName=t.arrowLeftClassName,this.arrowRighClasstName=t.arrowRighClasstName,this.autoPlay=t.autoPlay;var r=$("."+this.timeClassName),i=$("."+this.arrowLeftClassName),n=$("."+this.arrowRighClasstName),o=t.length,l=1;if(0==o)return console.log("空数据"),void 0;switch(l=o>=1&&4>o?1:3,r.slick({slidesToShow:l,arrows:!1,focusOnSelect:!0,draggable:!1}),i.on("click",function(){var t=e("prev");console.log(getIndexStr(t)),showServiceData(t)}),n.on("click",function(){var t=e("next");console.log("---"),console.log(t),console.log(getIndexStr(t)),showServiceData(t)}),l){case 1:showServiceData(0);break;case 3:showServiceData(1)}return l}$(".cal-time-item").remove(),$(".cal-time").append("<div class='cal-time-item'></div>");for(var e=this.timeArr,a="",r=0;e.length>r;r++)a+="<div>"+e[r]+"</div>";$(".cal-time-item").html(a),t({length:e.length,timeClassName:"cal-time-item",arrowLeftClassName:"cal-time-arrow-left",arrowRighClasstName:"cal-time-arrow-right",autoPlay:!0})},CmccTime.prototype.getData=function(){return this.timeArr},alert("hello world速度大"),Array.prototype.del=function(t){if(isNaN(t)||t>this.length)return!1;for(var e=0,a=0;this.length>e;e++)this[e]!=this[t]&&(this[a++]=this[e]);this.length-=1};